function drawMap(mapWrapper,colorScale,colorVar,mapTitle,width,height,margin){var mapScale=mobileScreen?4e3:5500,mapMove=mobileScreen?20:50,mapUp=mobileScreen?60:30,projection=d3.geo.mercator().center(d3.geo.centroid(gemeentesGeo)).scale(mapScale).translate([width/2+mapMove,height/2-mapUp]),path=d3.geo.path().projection(projection);mapWrapper.selectAll("path").data(gemeentesGeo.features).enter().append("path").attr("d",path).attr("id",function(t){return t.properties.GM_CODE}).attr("class",function(){return"gemeente map"}).style("opacity",1).style("stroke-width",1).style("stroke","white").style("fill",function(d){var value=eval("gemeentes[GM_CODES[d.properties.GM_CODE]]."+colorVar);return"NO"===gemeentes[GM_CODES[d.properties.GM_CODE]].NVM?"#E8E8E8":0>value?"#8C8C8C":colorScale(value)}).on("mouseover",fadeIn).on("mouseout",fadeOut).on("click",zoomTreemap)}function zoomTreemap(t){d3.selectAll(".cell."+t.properties.GM_CODE).each(function(t){zoom(t.parent,!0)})}function createMapLegend(t,e,a,r,n){var o=10,l=100,i=14,p=18,s=40,c=30,d=["0%","0 - 5%","5% - 10%","> 10%","Daling in huishoudensgroei","Transformatiepotentie onbekend"];t.attr("transform","translate(20,"+(r.top+a-s-c)+")"),t.append("text").attr("transform","translate(0,0)").attr("x",0).attr("y",0).attr("dy","0.35em").attr("class","legendTitle").style("text-anchor","start").style("font-size","11px").text(n).call(wrap,200);var m=t.selectAll(".scatterLegendSquare").data(["#bdd203","#8abc0c","#61a421","#3c8a2e","#8C8C8C","#E8E8E8"]).enter().append("g").attr("class","scatterLegendSquare").attr("width",100).attr("height",i).attr("transform",function(t,e){return"translate(0,"+((e+1)*i+p)+")"});m.append("rect").attr("width",l).attr("height",i).attr("transform","translate(0,0)").style("fill","white"),m.append("rect").attr("width",o).attr("height",o).attr("transform","translate(0,0)").style("fill",function(t){return t}),m.append("text").attr("transform","translate(20,"+o/2+")").attr("class","legendText").style("text-anchor","start").attr("dy",".30em").style("font-size","9px").text(function(t,e){return d[e]})}function drawCallout(t,e,a){var r=0,n=r+190;t.append("text").attr("class","callout").attr("id","callout_title").attr("transform","translate("+r+",10)").style("font-size","12px").style("fill","#0D0D0D").text("Groningen"),t.append("text").attr("class","callout").style("fill","#6E6E6E").attr("transform","translate("+r+",35)").text(e),t.append("text").attr("class","callout").style("fill","#6E6E6E").attr("transform","translate("+r+",50)").text(a),t.append("text").attr("class","callout").attr("id","callout_top").attr("transform","translate("+(n+25)+",35)").style("text-anchor","end").text("346"),t.append("text").attr("class","callout").attr("id","callout_bottom").attr("transform","translate("+(n+25)+",50)").style("text-anchor","end").text("3467"),t.append("line").attr("class","callout line").style("stroke-width",1).style("stroke","#D1D1D1").style("shape-rendering","crispEdges").attr("x1",0).attr("x2",1.2*n).attr("y1",17).attr("y2",17)}function drawTree(wrapper,subwrapper,colorScale,width,height,margin,sizeVar,colorVar){function comparator(t,e){return e.order-t.order}var clip=wrapper.append("defs").append("svg:clipPath").attr("id","clip").append("rect").attr("id","clip-rect").attr("x","0").attr("y","0").attr("width",width).attr("height",height);title=wrapper.append("text").attr("class","treeTitle").attr("transform","translate("+(width/2+margin.left)+","+margin.top/2+")").style("text-anchor","middle").style("font-size","18px").style("fill","#696969").text("Nederland"),subTitle=wrapper.append("text").attr("class","treeSubTitle").attr("transform","translate("+(width/2+margin.left)+","+(margin.top/2+15)+")").style("text-anchor","middle").style("font-size","11px").style("fill","#8F8F8F").attr("x",0).attr("y",0).attr("dy","0em").text("Klik op een gemeente om in te zoomen naar de bijbehorende provincie").call(wrap,.9*width),xTreeScale=d3.scale.linear().range([0,width]),yTreeScale=d3.scale.linear().range([0,height]);var treemap=d3.layout.treemap().round(!1).size([width,height]).sticky(!0).padding(2).sort(comparator).value(function(d){return eval("d."+sizeVar)});node=root=provinciesTree;var nodes=treemap.nodes(root).filter(function(d){return!d.children&eval("d."+sizeVar)>0}),cell=subwrapper.selectAll("g").data(nodes).enter().append("g").attr("class",function(t){return"cell "+t.GM_CODE}).on("click",function(t){return zoom(node==t.parent?root:t.parent,!0)}).on("mouseover",fadeIn).on("mouseout",fadeOut).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).style("cursor","pointer").append("svg").style("opacity",1);cell.append("rect").attr("width",function(t){return t.dx-1}).attr("height",function(t){return t.dy-1}).style("fill",function(d){return colorScale(eval("d."+colorVar))}),cell.append("text").attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").style("text-anchor","middle").style("fill","white").style("font-size","9px").text(function(t){return t.name}).style("opacity",function(t){return t.w=this.getComputedTextLength(),t.h=this.getBBox().height,t.dx>1.1*t.w&t.dy>t.h?1:0}),d3.select(window).on("click",function(){zoom(root,!0)})}function zoom(d,event){zoomLevel=d.name;var kx=width/d.dx,ky=height/d.dy;xTreeScale.domain([d.x,d.x+d.dx]),yTreeScale.domain([d.y,d.y+d.dy]);var t=subwrapper.selectAll("g").transition().duration(750).attr("transform",function(t){return"translate("+xTreeScale(t.x)+","+yTreeScale(t.y)+")"});t.select("rect").attr("width",function(t){return kx*t.dx-1}).attr("height",function(t){return ky*t.dy-1}),t.select("text").attr("x",function(t){return kx*t.dx/2}).attr("y",function(t){return ky*t.dy/2}).style("opacity",function(t){return"Nederland"==zoomLevel?kx*t.dx>1.1*t.w&ky*t.dy>t.h?1:0:1}),node=d,event&&d3.event.stopPropagation(),title.text(d.name),subTitle.text("Nederland"===zoomLevel?"Klik op een gemeente om in te zoomen naar de bijbehorende provincie":"Klik om weer uit te zoomen naar Nederland");var subset=[];gemeentes.forEach(function(t){t.Provincie===zoomLevel&&subset.push(t.GM_CODE)}),map.selectAll("path").style("fill",function(d){var value=eval("gemeentes[GM_CODES[d.properties.GM_CODE]]."+colorVar);return"NO"===gemeentes[GM_CODES[d.properties.GM_CODE]].NVM?"#E8E8E8":0>value?"#8C8C8C":colorScale(value)}),"Nederland"!=zoomLevel&&map.selectAll("path").filter(function(t){return $.inArray(t.properties.GM_CODE,subset)<=-1&void 0!=GM_CODES[t.properties.GM_CODE]}).style("fill","#8C8C8C")}function searchEventMapNL(t){""!=t?fadeIn(t):fadeOut()}function fadeIn(t){if("string"==typeof t)var e={GM_NAAM:t,GM_CODE:GM_NAMES[t]};else if(hasClass(d3.select(this),"cell"))var e=t;else var e=t.properties;map.selectAll("path").style("opacity",function(t){return t.properties.GM_CODE==e.GM_CODE?1:.2}),void 0!=GM_CODES[e.GM_CODE]&&treeMapChartPotentie.selectAll("g.cell").style("opacity",function(t){return t.GM_CODE==e.GM_CODE?1:.2}),mapCallout.selectAll("#callout_title").text(e.GM_NAAM),void 0===GM_CODES[e.GM_CODE]?(mapCallout.selectAll("#callout_top").text("-"),mapCallout.selectAll("#callout_bottom").text("-")):"NO"===gemeentes[GM_CODES[e.GM_CODE]].NVM?(mapCallout.selectAll("#callout_top").text(NLformat(10*Math.round(gemeentes[GM_CODES[e.GM_CODE]].behoefte_woningen/10,0))),mapCallout.selectAll("#callout_bottom").text("-")):(mapCallout.selectAll("#callout_top").text(NLformat(10*Math.round(gemeentes[GM_CODES[e.GM_CODE]].behoefte_woningen/10,0))),mapCallout.selectAll("#callout_bottom").text(NLformat(10*Math.round(gemeentes[GM_CODES[e.GM_CODE]].kantoren_woningen/10,0)))),mapCallout.style("visibility","visible")}function fadeOut(){mapCallout.style("visibility","hidden"),map.selectAll("path").style("opacity",1),treeMapChartPotentie.selectAll("g.cell").style("opacity",1)}function paletteGreen(t,e){var a=(e-t)/5;return d3.scale.threshold().range(["#bdd203","#93c201","#72b015","#589d25","#3c8a2e"]).domain([t+1*a,t+2*a,t+3*a,t+4*a])}var mapMargin={left:50,top:20,right:40,bottom:60},mapWidth=Math.min($(".dataresource.map").width(),500)-mapMargin.left-mapMargin.right,mapHeight=Math.max(550,7*mapWidth/5)-mapMargin.top-mapMargin.bottom,mobileScreen=$(window).width()>400?!1:!0,svgMap=d3.select(".dataresource.map").append("svg").attr("width",mapWidth+mapMargin.left+mapMargin.right).attr("height",mapHeight+mapMargin.top+mapMargin.bottom),map=svgMap.append("g").attr("class","map").attr("transform","translate("+mapMargin.left+","+mapMargin.top+")"),mapCallout=svgMap.append("g").attr("class","mapCallout").attr("transform","translate(5,"+3*mapMargin.top/4+")").style("visibility","hidden"),mapLegendWrapper=svgMap.append("g").attr("class","legend"),treeMargin={left:mobileScreen?20:50,top:mobileScreen?75:60,right:mobileScreen?20:50,bottom:20},treeWidth=Math.min($(".dataresource.treemap.potentie").width(),700)-treeMargin.left-treeMargin.right,treeHeight=mapHeight+50-(treeMargin.top-mapMargin.top),svgTreePotentie=d3.select(".dataresource.treemap.potentie").append("svg").attr("width",treeWidth+treeMargin.left+treeMargin.right).attr("height",treeHeight+treeMargin.top+treeMargin.bottom),treeMapChartPotentie=svgTreePotentie.append("g").attr("class","chart").attr("transform","translate("+treeMargin.left+","+treeMargin.top+")").attr("clip-path","url(#clip)"),treeLegendWrapperPotentie=svgTreePotentie.append("g").attr("class","legend"),zoomLevel,xTreeScale,yTreeScale,root,node,title,subTitle,GM_CODES=[],allGemeentes=[],GM_NAMES=[];gemeentes.forEach(function(t,e){GM_CODES[t.GM_CODE]=e,allGemeentes[e]=t.GM_NAAM,GM_NAMES[t.GM_NAAM]=t.GM_CODE});var colorGreen=d3.scale.threshold().range(["#bdd203","#8abc0c","#61a421","#3c8a2e"]).domain([1e-4,.05,.1]);drawMap(mapWrapper=map,colorScale=colorGreen,colorVar="perc_groei_trans",mapTitle="",width=mapWidth,height=mapHeight,margin=mapMargin),createMapLegend(mapLegendWrapper,mapWidth,mapHeight,mapMargin,"Huishoudensgroei in potentie op te vangen door kantorentransformatie"),drawCallout(calloutWrapper=mapCallout,topText="Verwachte huishoudensgroei tot 2025",bottomText="Woningen door kantorentransformatie");for(var options=allGemeentes,select=document.getElementById("searchBoxMapNL"),i=0;i<options.length;i++){var opt=options[i],el=document.createElement("option");el.textContent=opt,el.value=opt,select.appendChild(el)}$(".combobox").combobox(),drawTree(wrapper=svgTreePotentie,subwrapper=treeMapChartPotentie,colorScale=colorGreen,width=treeWidth,height=treeHeight,margin=treeMargin,sizeVar="potentie_leegstand_m2",colorVar="perc_groei_trans",title=""),d3.select(".mapRowWrapper").on("click",fadeOut);